---
import { mediaUrl, getTeamMembers } from '../../lib/payload';
import type { TeamMember } from '../../lib/payload';

interface Props {
  block: {
    populateFrom?: 'all' | 'manual' | null;
    members?: TeamMember[] | null;
    columns?: '3' | '4' | null;
  };
}

const { block } = Astro.props;
const cols = block.columns ?? '3';
const gridCols = cols === '4' ? 'lg:grid-cols-4' : 'lg:grid-cols-3';

let members: TeamMember[] = [];
if (block.populateFrom === 'manual' && block.members?.length) {
  members = block.members;
} else {
  members = await getTeamMembers().catch(() => []);
}
---

<section class="px-5 md:px-10 py-6 lg:py-8">
  <div class="max-w-[1440px] mx-auto">
    <div class={`grid grid-cols-2 sm:grid-cols-3 ${gridCols} gap-5 lg:gap-6`}>
      {members.map((member) => {
        const photo = mediaUrl(member.photo, 'card');
        return (
          <div class="text-center">
            <div class="w-28 h-28 lg:w-32 lg:h-32 rounded-full overflow-hidden mx-auto mb-3 bg-teal-tint">
              {photo ? (
                <img src={photo} alt={member.name ?? ''} class="w-full h-full object-cover" />
              ) : (
                <div class="w-full h-full flex items-center justify-center text-teal text-[32px] font-bold">
                  {(member.name ?? '?')[0]}
                </div>
              )}
            </div>
            <h3 class="text-[16px] lg:text-[18px] font-bold text-navy">{member.name}</h3>
            {member.role && <p class="text-muted text-[14px] lg:text-[15px] mt-0.5">{member.role}</p>}
          </div>
        );
      })}
    </div>
  </div>
</section>
